<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta name="generator" content="Movable Type 3.36" />

   <link rel="stylesheet" href="https://yama-kei.github.io/ltnm/styles-site.css" type="text/css" />
   <link rel="alternate" type="application/atom+xml" title="Atom" href="https://yama-kei.github.io/ltnm/atom.xml" />
   <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="https://yama-kei.github.io/ltnm/index.xml" />

   <title>Edge 705の走行データ(dat)をTCXファイルに変換 (鈍行・中目黒の自転車メモ)</title>

   <link rel="start" href="https://yama-kei.github.io/ltnm/" title="Home" />
   <link rel="prev" href="https://yama-kei.github.io/ltnm/2010/05/post_139.html" title="すばるライン試走と富士山一周サイクリング" />
   <link rel="next" href="https://yama-kei.github.io/ltnm/2010/05/edge_705_2.html" title="Edge 705 が不調" />

   <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
         xmlns:dc="http://purl.org/dc/elements/1.1/">
<rdf:Description
    rdf:about="https://yama-kei.github.io/ltnm/2010/05/edge_705dattcx.html"
    trackback:ping="http://www.yama-kei.org/mt/mt-tb.cgi/7042"
    dc:title="Edge 705の走行データ(dat)をTCXファイルに変換"
    dc:identifier="https://yama-kei.github.io/ltnm/2010/05/edge_705dattcx.html"
    dc:subject="サイクルコンピューター"
    dc:description="5/5の富士山一周以来Edge 705が不調。 詳細は改めてまとめるとして、Ed..."
    dc:creator="yama-kei"
    dc:date="2010-05-07T09:19:19+09:00" />
</rdf:RDF>
-->


   
   <script type="text/javascript" src="https://yama-kei.github.io/ltnm/mt-site.js"></script>
</head>
<body class="layout-two-column-right individual-entry-archive" onload="individualArchivesOnLoad(commenter_name)">
   <div id="container">
      <div id="container-inner" class="pkg">

         <div id="banner">
            <div id="banner-inner" class="pkg">
               <h1 id="banner-header"><a href="https://yama-kei.github.io/ltnm/" accesskey="1">鈍行・中目黒の自転車メモ</a></h1>
               <h2 id="banner-description"></h2>
            </div>
         </div>

         <div id="pagebody">
            <div id="pagebody-inner" class="pkg">
               <div id="alpha">
                  <div id="alpha-inner" class="pkg">

                     <p class="content-nav">
                        <a href="https://yama-kei.github.io/ltnm/2010/05/post_139.html">&laquo; すばるライン試走と富士山一周サイクリング</a> |
                        <a href="https://yama-kei.github.io/ltnm/">メイン</a>
                        | <a href="https://yama-kei.github.io/ltnm/2010/05/edge_705_2.html">Edge 705 が不調 &raquo;</a>
                     </p>


                     <h2 id="archive-title">Edge 705の走行データ(dat)をTCXファイルに変換</h2>
                     <div class="entry" id="entry-7042">
                        <div class="entry-content">
                                                      <div class="entry-body">
                              <p>5/5の富士山一周以来Edge 705が不調。<br />
詳細は改めてまとめるとして、Edge 705の走行データ(dat)をTCXファイルに変換するテクニックをマスターしたのでまとめてみる。</p>

<p>＊＊</p>

<p>Edge 705の走行データは本来PCに繋いだタイミングでTCX形式に変換されて閲覧可能な状態になるのだけど、それがうまくいかなかった場合は/Garmin/History/Laps ディレクトリ内に残されたdatファイルを以下の方法を使ってtcxファイルとしてねつ造することができる。</p>

<p>1. まともな.tcxファイルを持って来てテキストエディターで開き、最初の"Track"要素から最後に"Track"要素が閉じられるまでの部分を削除。これをtcxファイルのテンプレートとして保存。<br />
2. 遺された.datファイル(Lap1.dat、Lap2.dat・・・)をテキストエディターで開いて内容をコピーして、上のテンプレートの"Track"要素があったところにペースト。<br />
3. "Activity"要素内の"Id"と"Lap StartTime"のタイムスタンプをペーストした"Track"の最初に出てくる"Time"要素内のタイムスタンプに合わせる</p>

<p>これでWKO+やGCで読み込み可能なTCXファイルとして利用可能になる。<br />
TCXファイルの先頭部分に書かれた概要は、Edge 705側で集計した平均値や走行距離・時間。WKO+やGCでは生の走行データから独自に平均値や走行距離・時間を算出するので、テンプレートの先頭部分の概要データはいじらなくても問題は出ない。というか、これこそがEdge 705側の数値とPCにダウンロード後の数値が噛み合ない問題の元凶。</p>

<p>元ネタは<a href="https://forums.garmin.com/showpost.php?p=3911&postcount=2">こちら</a>。</p>

<p>＊＊</p>

<p>自分の理解だと、Edge 705のデータ保存は以下のようなノリで行われる。</p>

<p>1. 走行中のログは、内蔵フラッシュでもmicroSDでもないユーザが触れない内部フラッシュに保存される。</p>

<p>2. Lapが切られるか、Resetがかけられたタイミングで内蔵フラッシュのLapsディレクトリ内に生のラップ走行情報(.datファイル(TCXのサブセット形式(Trackタグの中身だけ)))が保存される。走行データの概要は、内部フラッシュに保存される。</p>

<p>3. PCにUSBマススト接続されると、内部フラッシュの概要とLapsディレクトリ内の生ログとを組み合わせた形でTCXファイルが生成され、成功した場合はLapsディレクトリ内のデータは消去される。</p>

<p>突然の電源断があった際にTrackpointタグの中身が不定の位置で壊れてることを考えると、走行中の内部フラッシュへの保存もTCXのサブセット形式で行われている可能性が高そう。</p>

<p>Edge 500でTCXをやめて独自のバイナリフォーマットに戻したことを考えると、やはりこの手の組み込みデバイスでXMLを使うのはいろいろ大変だったんだろうなーと推測。</p>
                           </div>
                           
                                        
                           
                        </div>
                        <p class="entry-footer">
                           <span class="post-footers">
                                                                  投稿者: <a href="http://www.yama-kei.org">yama-kei</a> 日時: 2010&#24180;05&#26376;07&#26085; 09:19
                               
                               
                           </span> 
                           <span class="separator">|</span> <a class="permalink" href="https://yama-kei.github.io/ltnm/2010/05/edge_705dattcx.html">パーマリンク</a>
                        </p>
                     </div>

<script type="text/javascript"><!--
google_ad_client = "pub-7948296006321133";
/* 728x15, 作成済み 09/09/04 */
google_ad_slot = "2400213415";
google_ad_width = 728;
google_ad_height = 15;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<br>

                                          <div class="trackbacks">
                        <h3 id="trackback" class="trackbacks-header">トラックバック</h3>
                        <div id="trackbacks-info">
                           <p>このエントリーのトラックバックURL: <br />http://www.yama-kei.org/mt/mt-tb.cgi/7042</p>
                        </div>
                        
                     </div>
                     

                                          <div id="comments" class="comments">
                        

                         
                        <form method="post" action="http://www.yama-kei.org/mt/mt-comments.cgi" name="comments_form" onsubmit="if (this.bakecookie.checked) rememberMe(this)">
                           <input type="hidden" name="static" value="1" />
                           <input type="hidden" name="entry_id" value="7042" />
                           
                           <div class="comments-open" id="comments-open">
                              <h2 class="comments-open-header">コメントを投稿</h2>
                              
                              <div class="comments-open-content">
                                 <script type="text/javascript">
                                 <!--
                                 writeTypeKeyGreeting(commenter_name, 7042);
                                 //-->
                                 </script>
                              
                                 

                                 <div id="comments-open-data">
                                    <div id="name-email">
                                       <p>
                                          <label for="comment-author">名前:</label>
                                          <input id="comment-author" name="author" size="30" />
                                       </p>
                                       <p>
                                          <label for="comment-email">メールアドレス:</label>
                                          <input id="comment-email" name="email" size="30" />
                                       </p>
                                    </div>

                                    <p>
                                       <label for="comment-url">URL:</label>
                                       <input id="comment-url" name="url" size="30" />
                                    </p>
                                    <p>
                                       <label for="comment-bake-cookie"><input type="checkbox"
                                          id="comment-bake-cookie" name="bakecookie" onclick="if (!this.checked) forgetMe(document.comments_form)" value="1" />
                                          この情報を登録しますか?</label>
                                    </p>
                                 </div>

                                 <p id="comments-open-text">
                                    <label for="comment-text">コメント: </label>
                                    <textarea id="comment-text" name="text" rows="15" cols="50"></textarea>
                                 </p>
                                 <div id="comments-open-footer" class="comments-open-footer">
                                    <input type="submit" accesskey="v" name="preview" id="comment-preview" value="確認" />
                                    <input type="submit" accesskey="s" name="post" id="comment-post" value="投稿" />
                                 </div>
                              </div>
                           </div>
                        </form>
                        
                     </div>
                     
                  </div>
               </div>
               <div id="beta">
                  <div id="beta-inner" class="pkg">

                      <div class="module-search module">
                         <h2 class="module-header">検索</h2>
                         <div class="module-content">
                            <form method="get" action="http://www.yama-kei.org/mt/mt-search.cgi">
                               <input type="hidden" name="IncludeBlogs" value="12" />
                               <label for="search" accesskey="4">ブログを検索: </label><br />
                               <input id="search" name="search" size="20" />
                               <input type="submit" value="検索" />
                            </form>
                         </div>
                      </div>

                      <div class="module-welcome module">
                         <h2 class="module-header">About</h2>
                         <div class="module-content">
                             <p class="first">2010&#24180;05&#26376;07&#26085; 09:19に投稿されたエントリーのページです。</p>
                             <p>ひとつ前の投稿は「<a href="https://yama-kei.github.io/ltnm/2010/05/post_139.html">すばるライン試走と富士山一周サイクリング</a>」です。</p>

                             <p>次の投稿は「<a href="https://yama-kei.github.io/ltnm/2010/05/edge_705_2.html">Edge 705 が不調</a>」です。</p>

                             <p>他にも多くのエントリーがあります。<a href="https://yama-kei.github.io/ltnm/">メインページ</a>や<a href="https://yama-kei.github.io/ltnm/archives.html">アーカイブページ</a>も見てください。</p>
                             
                         </div>
                      </div>

                      <div class="module-syndicate module">
                         <div class="module-content">
                            <a href="https://yama-kei.github.io/ltnm/atom.xml">このブログのフィードを取得</a><br />
                            [<a href="http://www.sixapart.jp/about/feeds">フィードとは</a>]
                         </div>
                      </div>

                      

                      <div class="module-powered module">
                         <div class="module-content">
                            Powered by<br /><a href="http://www.sixapart.jp/movabletype/">Movable Type 3.36</a>
                         </div>
                      </div>

                      <div class="module-content">
おすすめ自転車関連本
<SCRIPT charset="utf-8" type="text/javascript" src="http://ws.amazon.co.jp/widgets/q?ServiceVersion=20070822&MarketPlace=JP&ID=V20070822/JP/pastelcoloure-22/8001/2a48a3a9-c2dc-4b41-902c-9afcbf702492"> </SCRIPT> <NOSCRIPT><A HREF="http://ws.amazon.co.jp/widgets/q?ServiceVersion=20070822&MarketPlace=JP&ID=V20070822%2FJP%2Fpastelcoloure-22%2F8001%2F2a48a3a9-c2dc-4b41-902c-9afcbf702492&Operation=NoScript">Amazon.co.jp ウィジェット</A></NOSCRIPT>
</div><script type="text/javascript"><!--
google_ad_client = "pub-7948296006321133";
/* 160x600, 作成済み 09/06/03 */
google_ad_slot = "9835747242";
google_ad_width = 160;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

                  </div>
               </div>

            </div>
         </div>
      </div>
   </div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-9164977-1");
pageTracker._trackPageview();
} catch(err) {}</script>

</body>
</html>
